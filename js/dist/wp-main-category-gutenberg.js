"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var WPMainCategoryGutenberg=function(){var e=wp.hooks.addFilter,t=wp.element,n=t.createElement,r=t.Fragment,s=wp.components.SelectControl,i=wp.url.addQueryArgs,o=wp.apiFetch,a=lodash,u=a.sortBy,c=a.invoke,l={per_page:-1,orderby:"id",order:"asc",_fields:"id,name"};return function(){var t=function(){return document.getElementById("wpmc[_primary_category]")},a=function(){return t().value},f=function(e){return t().value=e},p={},h=function(){function e(t){_classCallCheck(this,e),this.slug=t,this.reset()}return _createClass(e,[{key:"registeredData",value:function(){return!!Object.keys(this.data).length}},{key:"reset",value:function(){this.data={}}},{key:"read",value:function(){return this.data}},{key:"get",value:function(e){return e in this.data&&this.data[e]||null}},{key:"set",value:function(e,t){return this.data[e]=t}}]),e}(),d=function(){return p.categories=new h("categories")},y=function(){return p.categories||d()},m=function(e){function t(e){var n;return _classCallCheck(this,t),n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e)),n.state={loading:!0},n}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){this.updateData(),this.dsAccess().registeredData()&&this.setState({loading:!1})}},{key:"componentWillUnmount",value:function(){c(this.fetchRequest,["abort"]),c(this.addRequest,["abort"])}},{key:"componentDidUpdate",value:function(e,t){if(this.updateData(),this.props.terms.length>2&&!this.dsAccess().get("availableTerms"))this.fetchTerms();else if(this.props.terms!==e.terms){var n=this.props.terms.filter(function(t){return-1===e.terms.indexOf(t)});n.length&&!this.isTermAvailable(n[0])&&this.fetchTerms()}}},{key:"updateData",value:function(){this.dsAccess().registeredData()||(this.dsAccess().set("availableTerms",[]),this.fetchTerms()),this.dsAccess().set("selectedTerms",this.props.terms)}},{key:"dsAccess",value:function(){return y()}},{key:"isTermAvailable",value:function(e){return this.dsAccess().get("availableTerms").some(function(t){return t.id===e})}},{key:"fetchTerms",value:function(){var e=this,t=this.props.taxonomy;t&&(this.setState({selectedTerms:this.props.terms,loading:!0}),this.fetchRequest=o({path:i("/wp/v2/".concat(t.rest_base),l)}),this.fetchRequest.then(function(t){e.fetchRequest=null,e.setState({loading:!1}),e.dsAccess().set("availableTerms",t),e.forceUpdate()},function(t){"abort"!==t.statusText&&(e.fetchRequest=null,e.setState({loading:!1}),e.forceUpdate())}))}}]),t}(React.Component),g=function(e){function t(e){var n;return _classCallCheck(this,t),n=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e)),n.onChange=n.onChange.bind(_assertThisInitialized(_assertThisInitialized(n))),n}return _inherits(t,e),_createClass(t,[{key:"getTermName",value:function(e){var t=this.dsAccess().get("availableTerms"),n=t.find(function(t){return t.id===e});return n&&n.name||""}},{key:"getSelectOptions",value:function(){var e=this,t=this.dsAccess().get("selectedTerms").sort().map(function(t){return{value:t,label:e.getTermName(t)}});return u(t,"label")}},{key:"onChange",value:function(e){this.setState({options:this.getSelectOptions(),value:f(e)});var t={value:a(),post_id:document.getElementById("post_ID").value,nonce:wpmc.nonce};wp.apiRequest({path:"/wpmc/v1/update-main-category",method:"POST",data:t}).then(function(e){return e},function(e){return e})}},{key:"isDisabled",value:function(){return this.state.loading}},{key:"render",value:function(){this.updateData();var e=a();return n(s,{label:"Primary Category",value:e,className:"wpmc-select",onChange:this.onChange,options:this.state.loading?"":this.getSelectOptions(),disabled:this.isDisabled()})}}]),t}(m);e("editor.PostTaxonomyType","wpmc/select",function(e){return function(t){function s(){return _classCallCheck(this,s),_possibleConstructorReturn(this,_getPrototypeOf(s).apply(this,arguments))}return _inherits(s,t),_createClass(s,[{key:"initSelectors",value:function(){var e=this.props,t=e.slug,s=e.terms;if("category"===t)return s.length>1?n(r,{},n(g,this.props)):null}},{key:"render",value:function(){return n(r,{},n(e,this.props),this.initSelectors())}}]),s}(m)},20)}}();$(window).load(function(){WPMainCategoryGutenberg()});